#GRIPPER

def gripper_example():
  CONTROL_BOX_IP = "localhost"

  global RPC = rpc_factory("xmlrpc", "http://" + CONTROL_BOX_IP_IP + ":41414")
  # Opretter forbindelse til gripper

  global TOOL_INDEX = 0
  # Valg af gripper

  def rg_is_busy():
    return RPC.rg_get_busy(TOOL_INDEX)
  end
# Tjek om gripper er i bevægelse - retunerer true hvis gripper stadig bevæger sig.
# Bruges til at vente, indtil en bevægelse er færdig

  def rg_grip(width, force = 20):
    RPC.rg_grip(TOOL_INDEX, width + .0, force + .0)
  # width: hvor meget gripperen åbnes/lukkes
  # force: hvor hårdt den griber
  # (If force is too low, the gripper may not move)

    sleep(0.01)
    while (rg_is_busy()):
    end
  end
# Lille pause - while-loop venter, indtil griberen ikke længere er busy

  rg_grip(0)
  rg_grip(50)
  rg_grip(0)
end

# selve bevægelsessekvensen (lukker gripper, åbner gripper 50 mm, lukker gripper igen)

# BEVÆGLESE MELLEM 2 KOORDINATER

def f():
  # Startpunktet: X_ORIGIN and Y_ORIGIN, Z.
  X_ORIGIN = 0
  Y_ORIGIN = -.4
  Z = .2
# Værktøjets orientering
  RX = 0
  RY = d2r(180)
  RZ = 0

  # Afstand mellem 2 punkter (Hver enhed i x eller y svarer til 10 cm)
  SEP = 0.1

  # Kernen - regner koordinter til 3D, bevæger med movej
  def move(x, y):
    movej(get_inverse_kin(p[X_ORIGIN + SEP * x, Y_ORIGIN + SEP * y, Z, RX, RY, RZ]))
  end

# bevægelsesfrekvens mellem punkter
  move(1, 1)
  move(3, 3)
  move(4, 1)
  move(2, 3)
end




#ANDET

using System;
using System.IO;
using System.Net.Sockets;
using System.Text;
using System.Threading.Tasks;

namespace InventorySystem;

# IP adresse på robotten
public class Robot(string ipAddress = "localhost", int dashboardPort = 29999, int urscriptPort = 30002)
{
    private readonly TcpClient _clientDashboard = new(); # Dashboard kommandoer
    private readonly TcpClient _clientUrscript = new(); # robotprogrammer (URScript)
    private Stream _streamDashboard;
    private StreamReader _streamReaderDashboard;
    private Stream _streamUrscript;
    public string IpAddress = ipAddress;

    public bool ProgramRunning # Returnerer true kun hvis begge forbindelser er aktive
    {
        get
        {
            if (_clientDashboard.Connected)
            {
                SendDashboard("running\n");
                return ReadLineDashboard() == "Program running: true";
            }

            return false;
        }
    }

    public bool Connected => _clientDashboard.Connected && _clientUrscript.Connected;

    public string RobotMode # Spørger robotten om on/off eller lign.
# Bruges til at vente på korrekt tilstand før næste trin.

    {
        get
        {
            SendDashboard("robotmode\n");
            return ReadLineDashboard();
        }
    }

    public void Connect() #Opretter TCP-forbindelse til dashboard, læser welcome besked, forbinder til URScript-port
    {
        _clientDashboard.Connect(IpAddress, dashboardPort);
        _streamDashboard = _clientDashboard.GetStream();
        _streamReaderDashboard = new StreamReader(_streamDashboard, Encoding.ASCII);

        // Consume Dashboard welcome message
        ReadLineDashboard();

        _clientUrscript.Connect(IpAddress, urscriptPort);
        _streamUrscript = _clientUrscript.GetStream();
    }


    public async void PowerOn() # asynkront kontrol-loop
    {
        SendDashboard("power on\n");
        ReadLineDashboard(); // Consume
        while (RobotMode != "Robotmode: IDLE") await Task.Delay(1000);
    }

    public async void BrakeRelease() # NU må robot bevæge sig
    {
        SendDashboard("brake release\n");
        ReadLineDashboard(); // Consume
        while (RobotMode != "Robotmode: RUNNING") await Task.Delay(1000);
    }


    public void Disconnect()
    {
        _clientDashboard.Close();
        _clientUrscript.Close();
    }


    public void SendDashboard(string command)
    {
        _streamDashboard.Write(Encoding.ASCII.GetBytes(command));
    }

    public void SendUrscript(string program) # Sender rå URScript-kode direkte til robotten (gripper, bevægelse)
    {
        _streamUrscript.Write(Encoding.ASCII.GetBytes(program));
    }

    public void SendUrscriptFile(string path) # Læser en .script-fil, sender den til robotten
    {
        var program = File.ReadAllText(path) + Environment.NewLine;
        SendUrscript(program);
    }

    public string ReadLineDashboard()
    {
        return _streamReaderDashboard.ReadLine();
    }
}
